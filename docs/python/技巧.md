## 1.单例模式

**a) 使用new方法**

```python
class SingleTon:

    def __new__(cls, *args, **kwargs):
        if not hasattr(cls, "_instance"):
            cls._instance = super(SingleTon, cls).__new__(cls, *args, **kwargs)
        return cls._instance


s1 = SingleTon()
s2 = SingleTon()

print(id(s1), id(s2))
# 1566005235664 1566005235664

```

**b) 使用装饰器**

```python
import functools


def singleton(cls):
    _instance = {}

    @functools.wraps(cls)
    def wrapped(*args, **kwargs):
        if cls not in _instance:
            _instance[cls] = cls(*args, **kwargs)
        return _instance[cls]

    return wrapped


@singleton
class MyClass:
    pass


s1 = MyClass()
s2 = MyClass()

print(id(s1), id(s2))
```

**c) 使用Python自带模块**

```python
# use_module.py
class SingleTon(object):

    def __init__(self, val):
        self.val = val

single = SingleTon(2)

# test_module.py
from use_module import single

a = single
b = single
print(a.val, b.val)
print(a is b)
a.val = 233
print(a.val, b.val)
```

**d) 使用metaclass**

```python
# SingleTon
# new返回MyClass
# init初始化MyClass的属性
# call的时候MyClass示例化，也就是MyClass()


class SingleTon(type):

    def __init__(cls, cls_name, cls_bases, cls_dict):
        # 给cls加上_instance属性
        if not hasattr(cls, "_instance"):
            cls._instance = None
        super(SingleTon, cls).__init__(cls_name, cls_bases, cls_dict)

    def __call__(cls, *args, **kwargs):
        if cls._instance is None:
            cls._instance = super(SingleTon, cls).__call__(*args, **kwargs)
        return cls._instance


class MyClass(metaclass=SingleTon):
    pass


s1 = MyClass()
s2 = MyClass()

print(id(s1), id(s2))
```





